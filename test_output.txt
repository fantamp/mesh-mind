============================= test session starts ==============================
platform darwin -- Python 3.12.2, pytest-9.0.1, pluggy-1.6.0
rootdir: /Users/fantamp/src/mesh-mind
configfile: pytest.ini
plugins: anyio-4.11.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 1 item

tests/test_summarizer.py F                                               [100%]

=================================== FAILURES ===================================
_________________________ test_summarize_chat_success __________________________

mock_run_agent_sync = <MagicMock name='run_agent_sync' id='4632641024'>

    def test_summarize_chat_success(mock_run_agent_sync):
        mock_run_agent_sync.return_value = "Summary text"
    
>       result = summarize_chat(chat_id="123", user_instruction="Make it short")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_summarizer.py:17: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/tenacity/__init__.py:338: in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/tenacity/__init__.py:477: in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/tenacity/__init__.py:378: in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/tenacity/__init__.py:420: in exc_check
    raise retry_exc.reraise()
          ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/tenacity/__init__.py:187: in reraise
    raise self.last_attempt.result()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
../../.pyenv/versions/3.12.2/lib/python3.12/concurrent/futures/_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
../../.pyenv/versions/3.12.2/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <Retrying object at 0x114322c60 (stop=<tenacity.stop.stop_after_attempt object at 0x108c4af00>, wait=<tenacity.wait.wa...bject at 0x108c4af30>, before=<function before_nothing at 0x10a6900e0>, after=<function after_nothing at 0x10a6725c0>)>
fn = <function run_summarizer at 0x1073719e0>, args = ()
kwargs = {'chat_id': '123', 'user_instruction': 'Make it short'}
retry_state = <RetryCallState 4633801072: attempt #5; slept for 32.0; last result: failed (TypeError run_summarizer() got an unexpected keyword argument 'user_instruction')>
do = <tenacity.DoAttempt object at 0x114322f30>

    def __call__(
        self,
        fn: t.Callable[..., WrappedFnReturnT],
        *args: t.Any,
        **kwargs: t.Any,
    ) -> WrappedFnReturnT:
        self.begin()
    
        retry_state = RetryCallState(retry_object=self, fn=fn, args=args, kwargs=kwargs)
        while True:
            do = self.iter(retry_state=retry_state)
            if isinstance(do, DoAttempt):
                try:
>                   result = fn(*args, **kwargs)
                             ^^^^^^^^^^^^^^^^^^^
E                   TypeError: run_summarizer() got an unexpected keyword argument 'user_instruction'

.venv/lib/python3.12/site-packages/tenacity/__init__.py:480: TypeError
=========================== short test summary info ============================
FAILED tests/test_summarizer.py::test_summarize_chat_success - TypeError: run...
============================== 1 failed in 35.94s ==============================
